
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.3">
    
    
      
        <title>Routing - Gardener on Metal Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4a0965b7.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Work Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#routing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Gardener on Metal Documentation" class="md-header__button md-logo" aria-label="Gardener on Metal Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gardener on Metal Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Routing
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/onmetal/documentation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Gardener on Metal Documentation" class="md-nav__button md-logo" aria-label="Gardener on Metal Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Gardener on Metal Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/onmetal/documentation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Compute
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Compute" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Compute
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/idea/" class="md-nav__link">
        Idea
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/onboarding/" class="md-nav__link">
        Hardware onboarding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/oob/" class="md-nav__link">
        OOB Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_4" type="checkbox" id="__nav_1_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2_4">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Virtualization" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_4">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/virtualization/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/virtualization/usage/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Networking" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../idea/" class="md-nav__link">
        Idea
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../address_structure/" class="md-nav__link">
        Address Structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../encapsulation/" class="md-nav__link">
        Encapsulation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Routing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Routing
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vnet" class="md-nav__link">
    VNet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4-vs-ipv6" class="md-nav__link">
    IPv4 vs. IPv6
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scenarios" class="md-nav__link">
    Scenarios
  </a>
  
    <nav class="md-nav" aria-label="Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#routing-within-a-customer-network" class="md-nav__link">
    Routing within a customer network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unequal-cost-multi-path-ucmp" class="md-nav__link">
    Unequal Cost Multi Path - UCMP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-to-the-internet" class="md-nav__link">
    Routing to the Internet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vnet-peering" class="md-nav__link">
    VNet Peering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nics/" class="md-nav__link">
        NIC Offloading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../networkfunctions/" class="md-nav__link">
        Network Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ddos/" class="md-nav__link">
        DDoS Protection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          Storage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Storage" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          Storage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Components" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/onmetal/onmetal-api" class="md-nav__link">
        onmetal-api
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Usage Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Usage Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Cluster API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        CSI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          API References
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API References" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API References
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/onmetal/onmetal-api/blob/main/docs/api-reference/overview.md" class="md-nav__link">
        onmetal-api
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Local setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Contribution Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Installation and Administration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation and Administration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Installation and Administration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Harbor
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Harbor" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Harbor
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/harbor/chart_museum/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/harbor/docker_registry/" class="md-nav__link">
        Usage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vnet" class="md-nav__link">
    VNet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4-vs-ipv6" class="md-nav__link">
    IPv4 vs. IPv6
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scenarios" class="md-nav__link">
    Scenarios
  </a>
  
    <nav class="md-nav" aria-label="Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#routing-within-a-customer-network" class="md-nav__link">
    Routing within a customer network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unequal-cost-multi-path-ucmp" class="md-nav__link">
    Unequal Cost Multi Path - UCMP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-to-the-internet" class="md-nav__link">
    Routing to the Internet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vnet-peering" class="md-nav__link">
    VNet Peering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/onmetal/documentation/edit/main/docs/network/routing.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="routing">Routing<a class="headerlink" href="#routing" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<h3 id="vnet">VNet<a class="headerlink" href="#vnet" title="Permanent link">&para;</a></h3>
<p>Every VNet has one routing table. A VNet is identified by a 24 bit Virtual Network Identifier (VNI). A VNet can have multiple subnets.</p>
<h3 id="ipv4-vs-ipv6">IPv4 vs. IPv6<a class="headerlink" href="#ipv4-vs-ipv6" title="Permanent link">&para;</a></h3>
<p>Gardener on Metal's underlay network is an IPv6-only network. The overlay network supports IPv4/IPv6 dual stack.
In this document mostly IPv4 addresses are used for the overlay. If nothing different is mentioned, the same techniques apply also to IPv6!</p>
<h2 id="scenarios">Scenarios<a class="headerlink" href="#scenarios" title="Permanent link">&para;</a></h2>
<h3 id="routing-within-a-customer-network">Routing within a customer network<a class="headerlink" href="#routing-within-a-customer-network" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Customer</th>
<th>VM</th>
<th>AZ</th>
<th>Hypervisor</th>
<th>VNI</th>
<th>Private IPv4</th>
<th>Public IPv4</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>VM A.1</td>
<td>FRA3</td>
<td>SRV C5.FRA3</td>
<td>10</td>
<td>10.0.0.1/32</td>
<td>233.252.0.103/32</td>
</tr>
<tr>
<td>A</td>
<td>VM A.2</td>
<td>FRA3</td>
<td>SRV C6.FRA3</td>
<td>10</td>
<td>10.0.0.2/32</td>
<td>203.0.113.12/32</td>
</tr>
<tr>
<td>A</td>
<td>VM A.3</td>
<td>FRA4</td>
<td>SRV C2.FRA4</td>
<td>10</td>
<td>10.0.0.3/32</td>
<td>203.0.113.47/32</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Hypervisor</th>
<th>AZ</th>
<th>IPv6</th>
</tr>
</thead>
<tbody>
<tr>
<td>SRV C5.FRA3</td>
<td>FRA3</td>
<td>2001:db8:f3:5::/64</td>
</tr>
<tr>
<td>SRV C6.FRA3</td>
<td>FRA3</td>
<td>2001:db8:f3:6::/64</td>
</tr>
<tr>
<td>SRV C2.FRA4</td>
<td>FRA4</td>
<td>2001:db8:f4:2::/64</td>
</tr>
</tbody>
</table>
<p><code>VM A.1</code> sends a ping request to <code>VM A.2</code>. This ping packet has an IPv4 header with <code>src IPv4: 10.0.0.1</code> and <code>dst IPv4: 10.0.0.2</code>.
The network hypervisor on <code>SRV C5.FRA3</code>, where <code>VM A.1</code> is running on, will encapsulate the packet. The encapsulation header will hold the following information: <code>dst IPv6: 2001:db8:f3:6::</code>, <code>VNI: 10</code>, <code>Protocol: 0x0800 (IPv4)</code>. In case of SRv6 encapsulation the VNI (10 = 0xa) would move into the dst IPv6 address: <code>SRv6 segment: 2001:db8:f3:6:a::</code>. The SRv6 segment address is provided via the routing control plane and MUST NOT be calculated by the packet's sender using the Host IP and VNI.</p>
<p>This is the simplest scenario of routing. To collect the information needed for encapsulating the packet, the hypervisor needs to receive all routes and all route updates of VNet 10. As soon as a new machine is joining VNet 10 or a machine gets terminated, route updates must be delivered to all hypervisors, that host VMs connected to VNet 10. This can be done via Kubernetes watches or, more performant, using a PubSub mechanism, that provides a queue per VNI. Route Updates will be published via this queue to all subscribers.
Using the route updates the hypervisor is able to create a routing table for VNet 10. The hypervisor will do longest prefix matching (LPM) for the target IP of the outgoing packet (here <code>10.0.0.2</code>) in the VM's respective VNI context.</p>
<p>When <code>VM A.1</code> sends a ping to <code>VM A.3</code> in a different AZ, the same happens again. The underlay networks of different AZs of the same region are routed - and also the routing information in the overlay networks is shared. The hypervisor would simply send the encapsulated packet to <code>SRV C2.FRA4</code>, which is located in FRA4 AZ.</p>
<p>Also, when a public IP is used as the destination IP, everything stays the same. Routing information of public endpoints, which reside in VNet 10, are distributed in the same way like private endpoints. When we look at IPv6, there are basically no "private" IP addresses anymore. Every IPv6 address is globally unique. But it is possible to not route them to the public internet - and by that make them "private".</p>
<h3 id="unequal-cost-multi-path-ucmp">Unequal Cost Multi Path - UCMP<a class="headerlink" href="#unequal-cost-multi-path-ucmp" title="Permanent link">&para;</a></h3>
<p>Two or more VMs may serve the same IP addresses. In this case there exist multiple routes for a given destination. Every route has a weight attached (0-255). According to the routes' weights outgoing flows will be assigned to the routes. E.g. if we have two routes to <code>10.0.0.2/32</code>, one with weight 100 and the other with weight 50, the first route will get assigned to <code>100/(100+50) = 2/3</code> of the new flows and the second route will be used for <code>50/(100+50) = 1/3</code> of the flows.</p>
<h3 id="routing-to-the-internet">Routing to the Internet<a class="headerlink" href="#routing-to-the-internet" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Customer</th>
<th>VM</th>
<th>AZ</th>
<th>Hypervisor</th>
<th>VNI</th>
<th>Private IPv4</th>
<th>Public IPv4</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>VM A.1</td>
<td>FRA3</td>
<td>SRV C5.FRA3</td>
<td>10</td>
<td>10.0.0.1/32</td>
<td>233.252.0.103/32</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Hypervisor</th>
<th>AZ</th>
<th>IPv6</th>
</tr>
</thead>
<tbody>
<tr>
<td>SRV C5.FRA3</td>
<td>FRA3</td>
<td>2001:db8:f3:5::/64</td>
</tr>
<tr>
<td>Router-1</td>
<td>FRA3</td>
<td>2001:db8:1::/64</td>
</tr>
<tr>
<td>Router-2</td>
<td>FRA3</td>
<td>2001:db8:2::/64</td>
</tr>
<tr>
<td>Router-3</td>
<td>FRA4</td>
<td>2001:db8:3::/64</td>
</tr>
<tr>
<td>Router-4</td>
<td>FRA4</td>
<td>2001:db8:4::/64</td>
</tr>
</tbody>
</table>
<p><code>VM A.1</code> sends a ping request to <code>8.8.8.8</code> using its public IPv4 address <code>233.252.0.103</code>. The hypervisor does LPM for the target IP. As this IP address is outside of the Gardener on Metal installation, the longest prefix that can be found is the default route <code>0.0.0.0/0</code>. This route can be found within the <code>VNet 10</code> routing context, but it comes with a different target VNI: 1. The <code>VNI 1</code> is reserved for external internet traffic. All traffic, that is coming from a VM going to the public internet, will be encapsulated using VNI 1. In VNet 10's routing table two routes are installed to serve the default route. The first route is via Router-1 (<code>0.0.0.0/0 via 2001:db8:1:: VNI 1 - loc FRA3 - weight 100</code>) and the second via Router-2 (<code>0.0.0.0/0 via 2001:db8:2:: VNI 1 - loc FRA3 - weight 100</code>). Both routes will be used respective to their weights using UCMP. Router-3 and Router-4 are located in FRA4 AZ. This will also be indicated in the route: Router-3 announces <code>0.0.0.0/0 via 2001:db8:3:: VNI 1 - loc FRA4 - weight 100</code>). The client MUST prefer routes that align with their own <code>loc</code> parameter (here FRA3).</p>
<p>How will the VNet 10 routing table be filled with default routes from VNet 1? We do not distribute the information about the default routes via the VNI 10 queue. We would need to do this for every customer's VNet, which would require publishing route updates to multiple hundreds or thousands of queues (remember, every VNet has its own queue). Instead the route updates will be published via the VNI 1 queue only. The hypervisor is also always subscribed to the VNI 1 queue and imports the routes received via VNI 1 queue to the VNI 10 routing context. This way route updates of VNI 1 need only be sent to the queue once, but will be received by all hypervisors.</p>
<p>The router needs to know where to deliver the Ping response to. We do not want the router to subscribe to all VNI queues that exist. Therefore the route information about the public endpoints (here <code>233.252.0.103/32 via 2001:db8:f3:5:: VNI 10 - loc FRA3 - weight 100</code>) will also be published to the VNI 2 queue. The routing table of VNet 2 will contain all publicly accessible endpoints of all customers. The routers will import the routes of VNet 2 and by that know where to route incoming traffic.
Also the hypervisors may import the routes from VNet 2. This would allow communication via public endpoints between different customers. The downside is, this results in larger routing tables on every hypervisor. If this appears as not feasible, the hypervisors will not import VNet 2 routes, but only the default routes from VNet 1. Then all traffic will go to the routers and from there to the other customer.</p>
<h3 id="vnet-peering">VNet Peering<a class="headerlink" href="#vnet-peering" title="Permanent link">&para;</a></h3>
<p>VNet Peering describes the routing between two different virtual networks. We already learned the technical principles behind VNet Peering when we looked at Routing to the Internet: Importing of routes of a different VNet.</p>
<p>The use case here is the following: Customer A and customer B want to set up a private connection between their infrastructures. <code>VM A.1</code> should be able to ping <code>VM B.2</code> and vice versa. VNet Peering works by importing routes from the neighbor's VNet.</p>
<table>
<thead>
<tr>
<th>Customer</th>
<th>VM</th>
<th>AZ</th>
<th>Hypervisor</th>
<th>VNI</th>
<th>Private IPv4</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>VM A.1</td>
<td>FRA3</td>
<td>SRV C5.FRA3</td>
<td>10</td>
<td>10.0.0.1/32</td>
</tr>
<tr>
<td>A</td>
<td>VM A.3</td>
<td>FRA3</td>
<td>SRV C4.FRA3</td>
<td>10</td>
<td>172.16.0.3/32</td>
</tr>
<tr>
<td>B</td>
<td>VM B.2</td>
<td>FRA3</td>
<td>SRV C6.FRA3</td>
<td>47</td>
<td>192.168.0.2/32</td>
</tr>
<tr>
<td>B</td>
<td>VM B.3</td>
<td>FRA3</td>
<td>SRV C1.FRA3</td>
<td>47</td>
<td>172.16.0.3/32</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Hypervisor</th>
<th>AZ</th>
<th>IPv6</th>
</tr>
</thead>
<tbody>
<tr>
<td>SRV C1.FRA3</td>
<td>FRA4</td>
<td>2001:db8:f3:1::/64</td>
</tr>
<tr>
<td>SRV C4.FRA3</td>
<td>FRA4</td>
<td>2001:db8:f3:4::/64</td>
</tr>
<tr>
<td>SRV C5.FRA3</td>
<td>FRA4</td>
<td>2001:db8:f3:5::/64</td>
</tr>
<tr>
<td>SRV C6.FRA3</td>
<td>FRA4</td>
<td>2001:db8:f3:6::/64</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Customer</th>
<th>VNI</th>
<th>Subnet</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>10</td>
<td>10.0.0.0/8</td>
</tr>
<tr>
<td>A</td>
<td>10</td>
<td>172.16.0.0/16</td>
</tr>
<tr>
<td>B</td>
<td>47</td>
<td>192.168.0.0/24</td>
</tr>
<tr>
<td>B</td>
<td>47</td>
<td>172.16.0.0/16</td>
</tr>
</tbody>
</table>
<p>When establishing a peering connectivity between two VNets the customers can decide if they want to import all foreign routes or only routes with a specific prefix.</p>
<p>In this example we have two customers A (VNI 10) and B (VNI 47). Customer A is using the subnet <code>10.0.0.0/0</code> (VM A.1) and <code>172.16.0.0/16</code> (VM A.3). Customer B uses the subnets <code>192.168.0.0/24</code> (VM B.2) and <code>172.16.0.0/16</code> (VM B.3). As you can see we have partly overlapping IP spaces: <code>172.16.0.0/16</code> is used by both customers. As a result we cannot import the routes from VNet 47 (customer B) with the prefix <code>172.16.0.0/16</code> into the VNet 10 (customer A). Still, we can import VNet 47 routes with the prefix <code>192.168.0.0/24</code> to VNet 10. So in this case it is required to not import all routes of VNet 47 into VNet 10 but use a filter for <code>192.168.0.0/24</code>.</p>
<p>To also have a route from VNet 47 to VNet 10 we need to import the <code>10.0.0.0/8</code> prefixed routes from VNet 10 into VNet 47.</p>
<p>As a result the routing table of VNet 10 looks like this:</p>
<table>
<thead>
<tr>
<th>Destination</th>
<th>VNI</th>
<th>via</th>
<th>Loc</th>
<th>Weight</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.0.0.1/32</td>
<td>10</td>
<td>2001:db8:f3:5::</td>
<td>FRA3</td>
<td>100</td>
<td></td>
</tr>
<tr>
<td>172.16.0.3/32</td>
<td>10</td>
<td>2001:db8:f3:4::</td>
<td>FRA3</td>
<td>100</td>
<td></td>
</tr>
<tr>
<td>192.168.0.2/32</td>
<td>47</td>
<td>2001:db8:f3:6::</td>
<td>FRA3</td>
<td>100</td>
<td>imported from VNet 47</td>
</tr>
</tbody>
</table>
<p>And the routing table of VNet 47 looks like this:</p>
<table>
<thead>
<tr>
<th>Destination</th>
<th>VNI</th>
<th>via</th>
<th>Loc</th>
<th>Weight</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.0.0.1/32</td>
<td>10</td>
<td>2001:db8:f3:5::</td>
<td>FRA3</td>
<td>100</td>
<td>imported from VNet 10</td>
</tr>
<tr>
<td>172.16.0.3/32</td>
<td>47</td>
<td>2001:db8:f3:1::</td>
<td>FRA3</td>
<td>100</td>
<td></td>
</tr>
<tr>
<td>192.168.0.2/32</td>
<td>47</td>
<td>2001:db8:f3:6::</td>
<td>FRA3</td>
<td>100</td>
<td></td>
</tr>
</tbody>
</table>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../encapsulation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Encapsulation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Encapsulation
            </div>
          </div>
        </a>
      
      
        
        <a href="../nics/" class="md-footer__link md-footer__link--next" aria-label="Next: NIC Offloading" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              NIC Offloading
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b028fd86.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f758a944.min.js"></script>
      
    
  </body>
</html>